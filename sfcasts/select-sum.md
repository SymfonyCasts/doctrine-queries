# SELECT the SUM (or COUNT)

Coming soon...

New goal team! If we look over at our `FortuneCookie` entity, one of the items on it is the number printed, like the number that we've ever printed of this fortune cookie. On the category page up here, I want to print the total number of fortune cookies that we've ever printed for this category. Now, we could solve this by doing something like where we loop over `category->getFortuneCookies()` and we have some sort of count that we increment by calling `getNumberPrinted()`. And that might work if we always have a small number of fortune cookies, but what if we had like 500 fortune cookies per category? In that case, we'd probably use pagination on this page to show them all, maybe just showing 10 fortune cookies at a time. So if we're only showing 10 fortune cookies at a time, we can't just loop over those ten to get the count, and we definitely don't want to query for all 500 and loop over all 500 just to get a count. In that case, what we're gonna need is a sum query. So let's build that.

In this case, the data we're trying to get is from the `FortuneCookie` entity. So instead of, in this case, we are going to open up the `FortuneCookieRepository` and add a new method there. Let's call it `public function countNumberPrintedForCategory(Category $category): int`. This will take a `Category` argument, and we'll return it. And this query will start pretty similar.

I'm actually gonna say `result = $this->createQueryBuilder('fortuneCookie')`. And I'll say how about `->select('SUM(fortuneCookie.numberPrinted) AS fortunesPrinted')`. This alias can be anything you want. I just try to make it something that's long enough that it's unique for my entity and then I use this alias consistently in all of my methods. So we're going to create that query builder, and remember when we create this query builder, it's gonna select all the data from `FortuneCookie`. We actually don't want that.

So in this case, I'm gonna say `select` to override that. Now previously in the `CategoryRepository`, we used `addSelect` that says take whatever you're selecting and also select these things. In this case, I'm purposely using `select` so that it overrides and we only select the data that I have here. Inside of here, it's gonna look a lot like a normal SQL query. We can use the `SUM` function that you're probably familiar with and then `fortuneCookie` and then the name of the property we want to use is `numberPrinted`. So `fortuneCookie.numberPrinted`, we don't have to do this but I'm gonna say `AS fortunesPrinted`. You'll see how that's gonna name that result when it comes back and you'll see that in a second.

So, it takes care of the `select`, and now we need an `andWhere`. Remember, I always use `andWhere`: `fortuneCookie.category = :category`. And then `setParameter` to fill that in: `category` and pass the `Category` object.

Now this is really interesting. In the database, we would normally say something like `WHERE fortuneCookie.categoryID = the_integer_ID`. In Doctrine, we don't think about the database, we think about our entities. So in this case, what we're doing is we say `fortuneCookie.category`, we're referencing the `category` property on `fortuneCookie`, and instead of passing just the integer ID, we're passing the entire `Category` object. It is possible to also pass the ID, but most of the time, you're actually going to pass the entire `Category` object like we are.

Alright, let's finish this: convert this to a query with `getQuery`. In this case, we are, if you think about it, we only want like one row of results. So we're gonna say `getOneOrNullResult`. And then we're gonna return `results` on the bottom.

Alright, so so far all of our queries have been giving us back objects. So does this change anything because we're selecting just this one thing? Let's find out. Let's `dd($result)` and then let's pop over to `FortuneController` and use this. So inside of here, this is our show page. We're also gonna need the `FortuneCookieRepository`.

So I'll say `FortuneCookieRepository` and then we'll say `fortunesPrinted` equals `fortuneCookieRepository->countNumberPrintedForCategory($category)`. Beautiful! Now I'll take that `fortunesPrinted` variable and we'll pass that into Twig as a new variable called `fortunesPrinted`. And finally, let's go find this template `showCategory.html.twig` and you see down here we have a little print history, so I'm gonna say, I'll pull little parentheses here inside curly braces `{{ fortunesPrinted|number_format }}` and that's really all we need assuming that's gonna be just a number. But let's actually make it even cooler by saying `number_format` and after this, I'll say total.

Alright! So let's actually see my way that `dd()` so let's refresh and awesome! So we see we get an array back with one key called `fortunesPrinted`. So back over here in `FortuneCookieRepository`, as soon as we actually start selecting specific data, we get back just that specific data. It's just like you'd expect with a normal SQL query. So to see this even a little closer, if I had said `select fortuneCookie`, which is redundant because that's what this already does, that would have given us a fortune cookie object. But as soon as we select just one thing, then it gets rid of the object and it just returns to us a nice associative array.

Alright, so we want this to return an int. So of course, what we could do here is say `return $result['fortunesPrinted']`. But whenever you have a situation where you're only selecting one row of data, you can actually just say `getSingleScalarResult()`. And now we should be able to just return that. In fact, actually, let me keep the `dd()` on first so we can see it. Yep, awesome! We get back just the number though. Notice.
