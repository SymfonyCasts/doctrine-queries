# JOINs

We've got this cool `->andWhere()` method where we're searching on `name` *or* the `iconKey` inside of our `Category.php` entity. But could we *also* search on the fortunes themselves *inside* of a category? Good question! Let's see how that relationship is set up. In `Category.php`, you can see that there's a `OneToMany` relationship on a property called `$fortuneCookies` over to the `FortuneCookie` entity.

If you think about this from a database perspective, if we want to modify our `WHERE` clause to be able to say `->andWhere fortuneCookie.fortune =` something, we need to `JOIN` over to that table. We're going to do the same thing with Doctrine, except, once again, we're not going to worry about joining across tables. We're going to `JOIN` across *entity classes*, which is a little weird but also really cool. In this case, we're going to `JOIN` across this `fortuneCookies` property over to the `FortuneCookie` entity, and then we'll be able to add our `WHERE` clause.

Up here in `CategoryRepository.php`... it doesn't matter where, but I'll go to the top... we're going to say `->leftJoin()`. We're joining from one category over to *many* fortune cookies so, as usual, we'll say `category,fortuneCookies` and, for the second argument, `fortuneCookie`, which is going to be the alias for that entity. We're saying `category` like normal, but when we say `fortuneCookies`, we're actually referring to the name of our property, which says we want to `JOIN` across this property. The cool thing about this is that we don't need the normal `ON` that we would normally see with a query. We don't need to include that because Doctrine already has that information internally from this mapping. We're just *joining* across this property.

One thing to keep in mind, which we'll talk more about in a second, is that, by joining over to something, we're not selecting more data. We're just making the properties on our `fortuneCookie` *available8 inside our query. This means I'm going to take my `->andWhere()` and make it *even longer*. Now we can say `OR fortuneCookie` (using our new alias right here) `.fortune` (because `$fortune` is the name of the property on our entity that actually stores the text) `LIKE :searchTerm`. It's that easy!

If we head back to our site, you can see we have the word "conclusion" in one of our fortunes, so if we spin over to the homepage and search for "conclusion"... got it! It looks like we have at least one match in our "Proverbs" category. And as usual, on the web debug toolbar, we can see the queries. Click to open that up in a new window... and you can see that there are *two* queries here. The first one is for the category, because we see `FROM category`, and the second query is actually `FROM fortune_cookie`. If we repeated this and went to the homepage, we see there are now *seven* queries in total: One for all of the categories and then an additional one to find all of the fortune cookies in each category - first, second, and third. Let's find out why that's happening and how we can fix it next.
