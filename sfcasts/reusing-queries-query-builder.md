# Reusing Queries in the Query Builder

Coming soon...

Until then, here is the legacy version: https://symfonycasts.com/screencast/doctrine-queries-legacy/reusing-queries-query-builder

Open CategoryRepository again. Alright, we have a couple places in here where we left join over to fortune cookies and select fortune cookies. And in the future, we may need to do that in even more spots inside of here. so it would be great if we could reuse that logic instead of repeating it over and over again. So let's do that. Anywhere inside of here, let's make a new private function called add fortune cookie, join and select. This is going to accept a query builder object, make sure you get the one from doctrine ORM, the object relational mapper. I'll call it QB. This is also going to return a query builder. So instead of here, it's pretty simple. I'm actually going to steal the join logic from above. We're going to say return and use QB and paste that and let me clean up my spacing. And that's it. We now have a method that we can call pass in a query builder and it will add the join in the select for us. So the result of this is pretty nice up here, we could say QB equals this arrow create query builder. And down here, we can say return this arrow add fortune cookies, join and select and pass in that QB. So we're passing in the QB which it modifies. But then because our new method returns the query builder as well, we can just chain off of it like normal. So we get that really nice result. And if we go over here and try the search, oh, of course that breaks because I need to remove my access. Join now it works. Let's repeat that same thing down here. So I'll say QB equals and then we'll say return this arrow add fortune cookie, join and select passing the QB. And then remember to remove my select and join on that one. This is for the category page. So if I click any category, perfect still got it. And we keep it make this a little bit easier. So instead of requiring the query builder object, we could say, make it optional. Then all we need to do down here is say use that QB return. If we have a QB, use that QB. Otherwise, this arrow create query builder category. There we go. So if there is a query builder passed in, we're just going to use this and call add select on it. Else will create a fresh query builder and then call add select on it. So the advantage of this is that we don't need to initialize our query builder at all up here. And then the same thing with the method above. But you can see also how important it is that we're using a consistent alias everywhere. You know, we're referencing category dot name, and category dot icon key and category dot ID. So we need to make sure that we always create their query builder using that exact alias. So everything works nicely. All right, while we're here, I'm going to create a method to reuse one other spot, which is going to be our ad our order by because we're probably going to want to always order by the same way. So I'll say add order by category name. And the same thing as before, we're going to have a query builder. qb equals null argument, we're going to return a query builder. And instead of here is this one's particularly simple. Actually, I'm gonna steal the code above. Actually, let me hit enter on this there, that looks a little bit better. So start the same way by creating a query builder if we need to, and they'll say add order by category, dot name. And then there's this criteria object descending, we use that earlier. And the place where we use that you can see up here in search, we're using that. So now we do need to actually kind of break this up a little bit. So we're going to start with qb equals this arrow, add order by category name, and pass no query builder, and then we'll pass that query builder to the second part. So unfortunately, as soon as you have to these shortcut methods, you can't chain them all together, you can only chain a little bit. But that still allows us to remove this order by down there. And this page still works. And if we search on the homepage, that works too. Alright, next, let's learn about the criteria system, which is a really cool way where we can efficiently filter collection relationships inside the database.
