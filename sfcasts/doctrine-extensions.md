# Using RAND() or Other Non-Supported Functions

For the heck of it, let's try to randomize the order of the fortunes on a page. Actually, let's find one. There we go. This one has four. So first, open up our controller. This is our show category. Right now we're just querying for the categories in the normal way. And then in our template, we're just looping over category.fortune cookies. So I'm actually going to change this back to our find with fortunes join, which is over here in our category repository. So this actually joins over to fortune cookie and selects it. It solves our n plus one problem. And now that we're calling this, we can actually control the order of the results. I'm going to say rand criteria ascending. So normally we think of the order by controlling the list of categories being returned. This will actually order the joined fortune cookies also. So when we loop over them, they're actually going to be in a different order. Which is kind of cool. Alright, and an error. Unexpected known function got rand. Wait, rand is a known MySQL function. Why doesn't it work? Well, remember, Doctrine supports a lot of functions inside of DQL, but not everything. Why not? Because Doctrine is designed to work with many different types of databases. And if only one or some databases support a function, like rand, then Doctrine can't support it. Fortunately, we can add this function or any custom function we want ourselves. Or really, we can do it via a library. Look for the Beverly Doctrine Extensions Library. This is awesome. It just allows you to add a whole bunch of different functions to a bunch of different databases. So let's go down here and grab the Composer Require line. Notice it has DevMaster on there. We don't really need that. So I'll paste that and take off DevMaster. Beautiful. And just by installing that, it doesn't change anything in our system. It just makes a bunch of these... It just adds a bunch of code that we can activate for any functions that we want. So the way we do that is back over in config packages, doctrine.yaml. We're going to go back down here. So again, we're under ORM. So I can put this really anywhere. And here we're going to say DQL. And there's a bunch of different categories under here.  You can read more about this on the documentation. But in this case, we want a numeric function. So numeric functions. And the name of the function is rand. And then we're going to set this to the class that will help explain to Doctrine what to do. So doctrine extensions slash query slash MySQL slash rand. Now you don't have to take my word for it over here. If you look in the documentation... Where is it? There we go. Don't take my word for it. If you go over here and there's this little config link down here. Click on MySQL. You can see it's kind of actually describing all the different ways and how you would activate them. All right. So I'm going to close that up. Refresh. Got it. So to see the difference there. Every time we refresh, those are coming back in a different order. That was easy. Okay. One more topic. Let's finish with some complex group by situations.
